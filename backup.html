<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ATUALIZADO AT√â NV 35!</title>
  <style>
    :root{
      --w: 360px;
      --h: 310px;

      --gold-1:#f7d27a;
      --gold-2:#c9902f;

      --text:#f3e7c6;
      --muted:#d7c79c;

      --green:#53d06a;
      --green-d:#2c7e3a;

      --shadow: 0 10px 30px rgba(0,0,0,.55);
    }
    /* DESKTOP */
    @media (min-width: 1024px){
      :root{
        --w: 520px;
        --h: 420px;
      }
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background: #14110f;
      font-family: "Trebuchet MS", Verdana, Arial, sans-serif;
      color: var(--text);
    }

    .window{
      width: var(--w);
      height: var(--h);
      border-radius: 10px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      border: 2px solid #2b1608;
      background: linear-gradient(#3b1d09, #241006);
    }

    .titlebar{
      height: 44px;
      padding: 0 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      background: linear-gradient(#7c4a17, #4a260b);
      border-bottom: 2px solid #2b1608;
    }
    .title{
      font-weight:700;
      letter-spacing:.2px;
      text-shadow: 0 1px 0 rgba(0,0,0,.65);
    }
    .close{
      width: 30px;
      height: 26px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,.25);
      background: linear-gradient(#f06c6c, #b11919);
      display:grid;
      place-items:center;
      cursor:pointer;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
    }
    .close span{font-weight:900;color:#fff;line-height:1}

    .content{
      height: calc(var(--h) - 44px);
      padding: 12px;
      background: linear-gradient(#4b250c, #2a1206);
    }

    .help{
      position:absolute;
      right: 14px;
      top: 52px;
      display:flex;
      align-items:center;
      gap:8px;
      color:#f2e2b8;
      font-weight:700;
      font-size: 13px;
      user-select:none;
    }
    .help .q{
      width: 18px; height:18px;
      border-radius: 50%;
      display:grid; place-items:center;
      background: linear-gradient(#d8b45c, #9a6a1d);
      border:1px solid rgba(0,0,0,.5);
      color:#241006;
      font-size: 12px;
      font-weight:900;
    }

    .main{
      display:grid;
      grid-template-columns: 120px 1fr;
      gap: 12px;
      margin-top: 20px;
    }

    .card{
      width: 120px;
      height: 150px;
      border-radius: 10px;
      border: 2px solid rgba(240,205,120,.85);
      background: linear-gradient(#1b120c, #130c08);
      box-shadow: 0 6px 18px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
    }
    .card .name{
      position:absolute;
      top: 6px;
      left: 8px;
      right: 8px;
      font-size: 10.5px;
      font-weight: 800;
      color: #f3d38b;
      text-shadow: 0 1px 0 rgba(0,0,0,.7);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      pointer-events:none;
    }
    .card .art{
      position:absolute;
      inset: 10px 10px 28px 10px;
      border-radius: 8px;
      background: linear-gradient(#2d1a0f, #140b06);
      border: 1px solid rgba(255,255,255,.12);
      display:grid;
      place-items:center;
      font-size: 54px;
      font-weight: 900;
      color:#f3e7c6;
      text-shadow: 0 2px 0 rgba(0,0,0,.6);
    }
    .card .qty{
      position:absolute;
      bottom: 6px;
      right: 8px;
      font-weight: 900;
      font-size: 14px;
      color: #67ff79;
      text-shadow: 0 1px 0 rgba(0,0,0,.7);
    }

    .right{padding-top: 2px;}

    /* LV menor + input sem caixa */
    .lvl{
      font-size: 18px; /* menor */
      font-weight: 900;
      color: #f2dfb0;
      text-shadow: 0 2px 0 rgba(0,0,0,.6);
      margin-bottom: 8px;
      display:flex;
      align-items:baseline;
      gap:6px;
      white-space:nowrap;
    }
    .ghost-input{
        width: 64px;
        border: 1px solid rgba(255,255,255,.10);
        border-radius: 8px;
        background: linear-gradient(#1a0d06, #120803); /* mesmo fundo do progresso */
        color: #f2dfb0;
        font-weight: 900;
        font-size: 18px;
        text-shadow: 0 2px 0 rgba(0,0,0,.6);
        padding: 4px 8px;
        outline: none;
        }
    .ghost-input::-webkit-outer-spin-button,
    .ghost-input::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }
    .ghost-input[type=number]{ -moz-appearance: textfield; }

    /* Progresso edit√°vel */
    .row{
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom: 8px;
      font-weight: 800;
      color:#f2dfb0;
      text-shadow: 0 1px 0 rgba(0,0,0,.55);
      font-size: 13px;
    }
    .progress-input{
      width: 70px;
      border:none;
      outline:none;
      background: rgba(0,0,0,.12);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 8px;
      padding: 4px 8px;
      color: #fff;
      font-weight: 900;
    }

    .progress-input::-webkit-outer-spin-button,
    .progress-input::-webkit-inner-spin-button{
    -webkit-appearance: none;
    margin: 0;
    }

    .progress-input[type=number]{
    -moz-appearance: textfield;
    }

    .bar-wrap{
      width: 100%;
      background: linear-gradient(#1a0d06, #120803);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 8px;
      padding: 4px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      margin-bottom: 12px;
    }
    .bar{
      height: 12px;
      border-radius: 6px;
      background: linear-gradient(#3a1b08, #2a1206);
      overflow:hidden;
    }
    .bar > i{
      display:block;
      height:100%;
      width: 37.1%;
      background: linear-gradient(var(--green), var(--green-d));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
      transition: width .15s ease;
    }
    .progress-text{
      margin-top: 6px;
      font-size: 12.5px;
      font-weight: 900;
      color: #f2dfb0;
    }

    /* N√≠vel desejado */
    .desired{
      margin-top: 10px;
      font-size: 16px;
      font-weight: 900;
      color:#f2dfb0;
      text-shadow: 0 2px 0 rgba(0,0,0,.6);
      display:flex;
      align-items:baseline;
      gap:8px;
    }
    .desired .ghost-input{width: 70px;}

    /* √Årea inferior: cartinha desenhada + n√∫mero */
    .actions{
      position:absolute;
      left: 0;
      right: 0;
      bottom: 10px;
      display:flex;
      justify-content:center;
      align-items:center;
      gap: 10px;
      padding: 0 12px;
    }
    .mini-card{
      width: 44px;
      height: 34px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.18);
      background: linear-gradient(#1b120c, #130c08);
      position:relative;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 6px 14px rgba(0,0,0,.25);
      display:grid;
      place-items:center;
    }
    .mini-card:before{
      content:"";
      position:absolute;
      inset: 6px;
      border-radius: 6px;
      border: 1px solid rgba(240,205,120,.55);
      opacity:.9;
    }
    .mini-card svg{opacity:.9}

    .rand{
      min-width: 130px;
      height: 36px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.18);
      background: linear-gradient(var(--gold-1), var(--gold-2));
      box-shadow: inset 0 2px 0 rgba(255,255,255,.25), 0 6px 14px rgba(0,0,0,.35);
      color:#2a1206;
      font-weight: 900;
      letter-spacing:.2px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 0 12px;
    }
    .rand:active{transform: translateY(1px)}
    .rand b{font-variant-numeric: tabular-nums;}

    /* MODO MODAL: aumenta a calculadora em % */
    body.modal{
      display: grid;
      place-items: center;
      background: transparent !important;
    }

    body.modal .window{
      transform: scale(1.45);        /* 145% (ajuste aqui) */
      transform-origin: center;
    }
  </style>
</head>

<body>
  <div class="window" role="dialog" aria-label="Upgrade de Cartas">
    <div class="titlebar">
      <div class="title">CALCULADORA - üÜï AT√â NV 35!</div>
    </div>

    <div class="content">
      <div class="main">
        <div class="card" aria-label="Carta">
          <div class="art">?</div>
        </div>

        <div class="right">
          <div class="lvl">
            Lv.
            <input id="lvlInput" class="ghost-input" type="number" min="0" max="999" value="0" />
          </div>

          <div class="row">
            <span>Progresso</span>
            <input id="progInput" class="progress-input" type="number" min="0" max="2500" value="0" />
            <span id="maxProgressText">/ 50</span>
          </div>

          <div class="bar-wrap" aria-label="Barra de progresso">
            <div class="bar"><i id="barFill"></i></div>
            <div class="progress-text"><span id="progText">0</span><span id="maxProgressText2">/50</span></div>
          </div>

          <div class="desired">
            N√≠vel desejado:
            <input id="desiredInput"
            class="ghost-input"
            type="number"
            min="0"
            max="35"
            value="0" />
        </div>
      </div>

      <div class="actions">
        <button class="rand" id="randBtn" type="button" title="Cartas necess√°rias">
          Cartas Necess√°rias: <b id="randNum">‚Äî</b>
        </button>
      </div>
    </div>
  </div>

    <script>
    const lvlInput = document.getElementById('lvlInput');
    const progInput = document.getElementById('progInput');
    const barFill = document.getElementById('barFill');
    const progText = document.getElementById('progText');
    const maxProgressText = document.getElementById('maxProgressText');
    const maxProgressText2 = document.getElementById('maxProgressText2');

    const randNum = document.getElementById('randNum');
    const randBtn = document.getElementById('randBtn');
    
    const desiredInput = document.getElementById('desiredInput');
    
    const p = new URLSearchParams(location.search);
    if (p.get("embed") === "1") document.body.classList.add("embed");
    if (p.get("mode") === "modal") document.body.classList.add("modal");

    desiredInput.addEventListener('input', () => {
        let v = parseInt(desiredInput.value || '0', 10);
        if (v > 35) v = 35;
        if (v < 0) v = 0;
        desiredInput.value = v;
    });

    function clamp(n, min, max){
        n = Number.isFinite(n) ? n : 0;
        return Math.min(max, Math.max(min, n));
    }

    function progressoMaxPorLvl(lvl){
        if (lvl >= 0 && lvl <= 9)   return 50;    // 0‚Üí1 ... 9‚Üí10
        if (lvl >= 10 && lvl <= 19) return 150;   // 10‚Üí11 ... 19‚Üí20
        if (lvl >= 20 && lvl <= 21) return 500;   // 20‚Üí21 e 21‚Üí22
        if (lvl >= 22 && lvl <= 26) return 750;   // 22‚Üí23 ... 26‚Üí27
        if (lvl >= 27 && lvl <= 28) return 1000;  // 27‚Üí28 e 28‚Üí29
        if (lvl === 29)             return 1250;  // 29‚Üí30
        if (lvl >= 30 && lvl <= 31) return 1500;  // 30‚Üí31 e 31‚Üí32 (2 n√≠veis)
        if (lvl === 32)             return 2000;  // 32‚Üí33
        if (lvl >= 33 && lvl <= 34) return 2500;  // 33‚Üí34 e 34‚Üí35 (2 n√≠veis)
        return 0; // lvl 35+ (n√£o h√° pr√≥ximo up)
    }

    function multProgressoPorAlma(lvl){
        if (lvl >= 29) return 1.85;  // Novos n√≠veis: 29+
        if (lvl >= 11) return 1.33;  // N√≠veis m√©dios: 11-28
        return 1.0;                  // N√≠veis iniciais: 0-10
    }

    function setMaxTexts(pmax){
        maxProgressText.textContent = `/ ${pmax}`;
        maxProgressText2.textContent = `/${pmax}`;
    }

    function calcularCartasNecessarias(lvlAtual, progAtual, lvlDesejado){
        if (lvlDesejado <= lvlAtual) return 0;

        let almas = 0;
        let lvl = lvlAtual;
        let prog = progAtual;

        while (lvl < lvlDesejado) {
            const pmax = progressoMaxPorLvl(lvl);
            if (pmax <= 0) break; // travou em 35+

            const falta = Math.max(0, pmax - prog);
            const mult = multProgressoPorAlma(lvl);

            almas += (falta / mult);

            // pr√≥ximo n√≠vel come√ßa com 0 progresso
            lvl += 1;
            prog = 0;
        }

        const cartas = almas / 1.5;
        return cartas;
    }

    function updateAll(){
        const lvlAtual = clamp(parseInt(lvlInput.value || "0", 10), 0, 999);
        lvlInput.value = lvlAtual;

        const pmax = progressoMaxPorLvl(lvlAtual);
        setMaxTexts(pmax);

        // Ajusta o max do input e corrige progresso atual
        progInput.max = String(pmax > 0 ? pmax : 0);
        const progAtual = clamp(parseInt(progInput.value || "0", 10), 0, pmax > 0 ? pmax : 0);
        progInput.value = progAtual;

        // Barra
        progText.textContent = progAtual;
        const pct = (pmax > 0) ? (progAtual / pmax * 100) : 0;
        barFill.style.width = pct.toFixed(1) + "%";

        // N√≠vel desejado
        const lvlDesejado = clamp(parseInt(desiredInput.value || "0", 10), 0, 35);
        desiredInput.value = lvlDesejado;

        // Cartas necess√°rias (arredondando pra cima para inteiro)
        const cartas = calcularCartasNecessarias(lvlAtual, progAtual, lvlDesejado);
        const cartasInt = Math.ceil(cartas);

        randNum.textContent = (pmax <= 0 && lvlDesejado > lvlAtual)
            ? "‚Äî" // n√£o calcula acima de 35 (sem custo definido)
            : String(cartasInt);
    }

    function setDisabled(el, disabled){
        el.disabled = disabled;
        el.style.opacity = disabled ? "0.65" : "1";
        el.style.cursor  = disabled ? "not-allowed" : "";
    }

    // cria/garante um texto sobre a barra
    function ensureBarLabel(){
        const bar = document.querySelector('.bar');
        if (!bar) return null;

        bar.style.position = "relative";

        let label = document.getElementById("barLabel");
        if (!label){
            label = document.createElement("div");
            label.id = "barLabel";
            label.style.position = "absolute";
            label.style.inset = "0";
            label.style.display = "grid";
            label.style.placeItems = "center";
            label.style.fontWeight = "900";
            label.style.fontSize = "12px";
            label.style.textShadow = "none";
            label.style.pointerEvents = "none";
            bar.appendChild(label);
        }
        return label;
    }

    const barLabel = ensureBarLabel();

    function updateProgress(){
        const lvl = clamp(parseInt(lvlInput.value || "0", 10), 0, 35);
        lvlInput.value = lvl;

        const isMax = (lvl >= 35);

        if (isMax){
            // bloqueia
            setDisabled(progInput, true);
            setDisabled(desiredInput, true);

            // barra amarela cheia
            barFill.style.width = "100%";
            barFill.style.background = "linear-gradient(#f7d27a, #c9902f)";

            // texto sobre a barra (APENAS no lvl m√°ximo)
            if (barLabel){
                barLabel.textContent = "Chegou ao n√≠vel m√°ximo";
                barLabel.style.color = "#fff";
                barLabel.style.textShadow = "0 1px 2px rgba(0,0,0,.75)";
            }

        } else {
            // desbloqueia
            setDisabled(progInput, false);
            setDisabled(desiredInput, false);

            const pmax = progressoMaxPorLvl(lvl);
            const v = clamp(parseInt(progInput.value || "0", 10), 0, pmax);
            progInput.value = v;

            // barra normal
            barFill.style.width = (pmax > 0 ? (v / pmax * 100) : 0).toFixed(1) + "%";
            barFill.style.background = "linear-gradient(var(--green), var(--green-d))";

            // remove texto e estilos do modo m√°ximo
            if (barLabel){
                barLabel.textContent = "";
                barLabel.style.color = "";
                barLabel.style.textShadow = "";
            }

            progText.textContent = v;
        }
    }

    // limites + updates
    lvlInput.addEventListener('input', () => {
        updateProgress();
        updateAll();
    });
    
    progInput.addEventListener('input', () => {
        updateProgress();
        updateAll();
    });
    
    desiredInput.addEventListener('input', () => {
        let v = clamp(parseInt(desiredInput.value || "0", 10), 0, 35);
        desiredInput.value = v;
        updateAll();
    });

    updateProgress();
    updateAll();

    // "Bot√£o" fica s√≥ como display (n√£o gera aleat√≥rio)
    randBtn.addEventListener('click', (e) => { e.preventDefault(); });

    (function(){
      const p = new URLSearchParams(location.search);
      if (p.get("mode") === "modal") document.body.classList.add("modal");
      if (p.get("embed") === "1") document.body.classList.add("embed");
    })();
    </script>

</body>
</html>